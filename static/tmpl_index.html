<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQLite Viewer</title>
    <link rel="stylesheet" href="[[PLUGIN_STATIC_DIR]]/styles.css">
    <script src="[[PLUGIN_STATIC_DIR]]/vue2.js"></script>
</head>

<body>
    <div id="app">
        <!-- Global Loading Overlay -->
        <div v-show="isLoading" class="loading-overlay">
            <div class="loading-spinner"></div>
            <div class="loading-text">{{ loadingMessage }}</div>
        </div>

        <!-- Header Section -->
        <div class="header">
            <h1 class="app-title">üìä SQLite Database Viewer</h1>
            
            <!-- Search Bar -->
            <div class="search-container">
                <input 
                    type="text" 
                    v-model="searchQuery" 
                    placeholder="üîç ÊêúÁ¥¢Ë°®Âêç..."
                    class="search-input"
                />
                <button v-if="searchQuery" @click="clearSearch()" class="clear-search-btn">‚úï</button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div v-for="(node, index) in filteredTreeNodes" :key="index" class="tree-node">
                <!-- Ê†ëËäÇÁÇπ -->
                <div class="tree-node-title" :class="{
                        'tree-node-expanded': node.expanded,
                        'tree-node-collapsed': !node.expanded,
                        'tree-node-active': currentNodeName === node.name,
                        'tree-node-loading': node.isLoading
                    }" @click="toggleNode(node, index)">
                    <span class="node-icon">{{ node.isCustom ? '‚ö°' : 'üìã' }}</span>
                    <span class="node-label">{{ node.label }}</span>
                    <span v-if="node.total > 0" class="node-count">({{ node.total.toLocaleString() }} Ë°å)</span>
                    <div v-if="node.isLoading" class="inline-spinner"></div>
                </div>

                <!-- ÂÜÖÂÆπÂÆπÂô® -->
                <div v-show="node.expanded" class="view-div">
                    <div v-if="node.isCustom" class="custom-sql-section">
                        <div class="sql-query">
                            <textarea 
                                v-model="sqlInput" 
                                placeholder="ËØ∑ËæìÂÖ• SQL Êü•ËØ¢ËØ≠Âè•..."
                                class="sql-textarea"
                                rows="3"
                            ></textarea>
                            <button @click="executeCustomQuery(index)" class="execute-btn" :disabled="isLoading">
                                ‚ñ∂Ô∏è ÊâßË°åÊü•ËØ¢
                            </button>
                        </div>
                    </div>
                    
                    <!-- Pagination Controls -->
                    <div v-if="!node.isCustom && node.data && node.total > 0" class="pagination-container">
                        <div class="pagination-info">
                            Á¨¨ {{ node.currentPage }} È°µ / ÂÖ± {{ Math.ceil(node.total / node.pageSize) }} È°µ 
                            / ÊÄªËÆ° {{ node.total.toLocaleString() }} Êù°ËÆ∞ÂΩï
                        </div>
                        
                        <div class="pagination-controls">
                            <button 
                                :disabled="node.currentPage === 1" 
                                @click="renderPage(node, index, node.currentPage - 1)"
                                class="pagination-btn"
                            >
                                ‚èÆÔ∏è ‰∏ä‰∏ÄÈ°µ
                            </button>
                            
                            <!-- È°µÁ†ÅÊåâÈíÆ -->
                            <template v-for="page in visiblePages(node)" :key="page">
                                <button 
                                    :class="{ 
                                        'pagination-btn': true,
                                        'pagination-btn-active': page === node.currentPage,
                                        'pagination-btn-ellipsis': page === '...'
                                    }" 
                                    :disabled="page === '...'"
                                    @click="renderPage(node, index, page)"
                                >
                                    {{ page }}
                                </button>
                            </template>
                            
                            <button 
                                :disabled="node.currentPage * node.pageSize >= node.total"
                                @click="renderPage(node, index, node.currentPage + 1)"
                                class="pagination-btn"
                            >
                                ‰∏ã‰∏ÄÈ°µ ‚è≠Ô∏è
                            </button>
                        </div>
                        
                        <div class="page-size-control">
                            <label for="page-size">ÊØèÈ°µÊòæÁ§∫:</label>
                            <select 
                                v-model="node.pageSize" 
                                @change="changePageSize(node, index, node.pageSize)"
                                class="page-size-select"
                            >
                                <option v-for="size in [10, 20, 50, 100, 200]" :key="size" :value="size">
                                    {{ size }}
                                </option>
                            </select>
                        </div>
                    </div>

                    <!-- Data Table -->
                    <div v-if="node.data && node.data.length > 0" class="table-container">
                        <div class="table-wrapper">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th class="row-number-header">#</th>
                                        <th v-for="(column, columnIndex) in node.columns" :key="columnIndex" class="column-header">
                                            {{ column }}
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="(row, rowIndex) in node.data" :key="rowIndex" class="data-row">
                                        <td class="row-number">{{ node.pageSize * (node.currentPage - 1) + rowIndex + 1}}</td>
                                        <td v-for="(column, columnIndex) in node.columns" :key="columnIndex" class="data-cell">
                                            <span :title="row[column]" class="cell-content">
                                                {{ row[column] === null ? '(NULL)' : row[column] }}
                                            </span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div v-else-if="node.expanded && !node.isLoading" class="no-data-message">
                        üì≠ ÊöÇÊó†Êï∞ÊçÆ
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="[[PLUGIN_STATIC_DIR]]/scripts.js"></script>
</body>

</html>